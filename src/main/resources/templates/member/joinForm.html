<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:insert="~{include/head}"></head>
<script src="http://dmaps.daum.net/map_js_init/postcode.v2.js"></script>

<style>
	.id_input_re_1, .alert-success {
	color:#008000;
	display: none;
	}
	
	.id_input_re_2, .alert-danger{
	color: #ff0000;
	display: none;
	}
</style>
</head>

<body>
	<div style="display: none">
		<div id="loadingBarDiv" style="display: none"></div>
	</div>
	<div id="mapleMainPopwrap"
		style="position: fixed; top: 50%; left: 50%; width: 81.333333%; z-index: 805; transform: translate(-50%, -50%); display: none;"></div>
	<div class="layerArea" id="mapleLayer" style="display: none">
		<div class="layerBg"></div>
	</div>
	<div class="hsome_allContents_wrapper">
		<div class="hsome_allContents">
			<header class="hsome_header">
				<h1 class="h_ttl ellipsis" id="headerTitle">회원정보입력</h1>
				<div th:insert="~{include/member-header}"></div>
			</header>
			<div class="hsome_contents mbr_signup_wrap signup_wrap">
				<div class="mem_ct_wrap_bg">
					<h5 class="no_margin">더한섬닷컴 가입을 환영합니다!</h5>
				</div>
				<div class="mem_ct_wrap" style="padding-top: 0px;">
					<form name="join_form" id="memberJoinForm" action="/member/join" method="POST">
					
						<div class="chk_agree_wrap">
							<div class="req_txt"
								style="padding-top: 15px; padding-bottom: 15px;">
								<i class="txt_point">*</i>표시는 필수항목입니다.
							</div>
							
							<div style="padding-bottom: 0px; height: 20px;">
								<h5 class="w_helper">아이디<i class="txt_point">*</i></h5>
							</div>
							<div class="flex">
								<div class="input_user_pw">
									<input type="text" id="mid" name="mid" class="id_input"
									placeholder="아이디를 입력하세요." title="아이디를 입력하세요." maxlength="100">
								</div>
							</div>
								<!-- id ajax 중복체크 -->
								<span class="id_input_re_1">사용 가능한 아이디입니다.</span> 
								<span class="id_input_re_2">아이디가 이미 존재합니다.</span>
								
							<div style="padding-bottom: 0px; height: 20px; margin-top: 10px;">
								<h5 class="w_helper">이메일<i class="txt_point">*</i></h5>
							</div>
							<div class="input_user_email">
								<input type="text" id="memail" name="memail" class="user_email" 
								placeholder="이메일을 입력하세요." title="이메일을 입력하세요." maxlength="100">
							</div>
							
							<div class="input_group">
								<div style="padding-bottom: 0px; height: 20px;">
									<h5 class="w_helper">비밀번호<i class="txt_point">*</i>
								</div>
								<div class="input_user_pw">
									<input type="password" id="mpassword" name="mpassword" class="user_pw"
										placeholder="비밀번호를 입력하세요." title="비밀번호를 입력하세요."
										maxlength="100">
								</div>
									<span class="alert-success"> 비밀번호가 일치합니다.</span> 
									<span class="alert-danger"> 비밀번호가 불일치합니다.</span>
								
								<div class="input_user_pw">
									<input type="password" class="user_pw" id="mpassword2"  name="mpassword2"
										placeholder="비밀번호를 한번 더 입력하세요." title="비밀번호를 한번 더 입력하세요."
										maxlength="100">
								</div>
								<!-- [TO DEV] Error msg here. -->
								<div class="err_wrap">
									<p class="err_txt" id="pwcMsg">
										<!-- 입력한 비밀번호가 일치하지 않습니다. -->
									</p>
								</div>

								<div style="padding-bottom: 0px; height: 20px;">
									<h5 class="w_helper" style="margin-top: 15px;">이름<i class="txt_point">*</i>
								</div>
								<div class="input_user_pw">
									<input type="text" id="mname" name="mname" class="user_pw"
										placeholder="이름을 입력하세요." title="이름을 입력하세요." maxlength="100">
								</div>
								
								<div style="padding-bottom: 0px; height: 20px;">
									<h5 class="w_helper" style="margin-top: 15px; margin-bottom: 5px;">핸드폰 번호<i class="txt_point">*</i>
									<input type="number" id="mtel" name="mtel" class="user_pw"
										placeholder="'-' 없이 숫자만 입력" title="핸드폰 번호를 입력하세요." maxlength="100">
								</div>
								<div class="err_wrap">
									<p class="err_txt" id="nameMsg"></p>
								</div>
								
								<div style="padding-bottom: 0px; height: 110px;">
									<h5 class="pd_title" style="margin-top: 15px;">생년월일<i class="txt_point">*</i></h5>
								<div class="input_user_bday">
									<div class="bday_year">
										<div class="select_box">
											<select id="selYear" name="year">
												<option value="">년</option>
												<option value="2009">2009</option>
												<option value="2008">2008</option>
												<option value="2007">2007</option>
												<option value="2006">2006</option>
												<option value="2005">2005</option>
												<option value="2004">2004</option>
												<option value="2003">2003</option>
												<option value="2002">2002</option>
												<option value="2001">2001</option>
												<option value="2000">2000</option>
												<option value="1999">1999</option>
												<option value="1998">1998</option>
												<option value="1997">1997</option>
												<option value="1996">1996</option>
												<option value="1995">1995</option>
												<option value="1994">1994</option>
												<option value="1993">1993</option>
												<option value="1992">1992</option>
												<option value="1991">1991</option>
												<option value="1990">1990</option>
												<option value="1989">1989</option>
												<option value="1988">1988</option>
												<option value="1987">1987</option>
												<option value="1986">1986</option>
												<option value="1985">1985</option>
												<option value="1984">1984</option>
												<option value="1983">1983</option>
												<option value="1982">1982</option>
												<option value="1981">1981</option>
												<option value="1980">1980</option>
												<option value="1979">1979</option>
												<option value="1978">1978</option>
												<option value="1977">1977</option>
												<option value="1976">1976</option>
												<option value="1975">1975</option>
												<option value="1974">1974</option>
												<option value="1973">1973</option>
												<option value="1972">1972</option>
												<option value="1971">1971</option>
												<option value="1970">1970</option>
												<option value="1969">1969</option>
												<option value="1968">1968</option>
												<option value="1967">1967</option>
												<option value="1966">1966</option>
												<option value="1965">1965</option>
												<option value="1964">1964</option>
												<option value="1963">1963</option>
												<option value="1962">1962</option>
												<option value="1961">1961</option>
												<option value="1960">1960</option>
												<option value="1959">1959</option>
												<option value="1958">1958</option>
												<option value="1957">1957</option>
												<option value="1956">1956</option>
												<option value="1955">1955</option>
												<option value="1954">1954</option>
												<option value="1953">1953</option>
												<option value="1952">1952</option>
												<option value="1951">1951</option>
												<option value="1950">1950</option>
												<option value="1949">1949</option>
												<option value="1948">1948</option>
												<option value="1947">1947</option>
												<option value="1946">1946</option>
												<option value="1945">1945</option>
												<option value="1944">1944</option>
												<option value="1943">1943</option>
												<option value="1942">1942</option>
												<option value="1941">1941</option>
												<option value="1940">1940</option>
												<option value="1939">1939</option>
												<option value="1938">1938</option>
												<option value="1937">1937</option>
												<option value="1936">1936</option>
												<option value="1935">1935</option>
												<option value="1934">1934</option>
												<option value="1933">1933</option>
												<option value="1932">1932</option>
												<option value="1931">1931</option>
												<option value="1930">1930</option>
												<option value="1929">1929</option>
												<option value="1928">1928</option>
												<option value="1927">1927</option>
												<option value="1926">1926</option>
												<option value="1925">1925</option>
												<option value="1924">1924</option>
												<option value="1923">1923</option>
												<option value="1922">1922</option>
												<option value="1921">1921</option>
												<option value="1920">1920</option>
												<option value="1919">1919</option>
												<option value="1918">1918</option>
												<option value="1917">1917</option>
												<option value="1916">1916</option>
												<option value="1915">1915</option>
												<option value="1914">1914</option>
												<option value="1913">1913</option>
												<option value="1912">1912</option>
												<option value="1911">1911</option>
												<option value="1910">1910</option>
												<option value="1909">1909</option>
												<option value="1908">1908</option>
												<option value="1907">1907</option>
												<option value="1906">1906</option>
												<option value="1905">1905</option>
												<option value="1904">1904</option>
												<option value="1903">1903</option>
												<option value="1902">1902</option>
												<option value="1901">1901</option>
												<option value="1900">1900</option>
											</select>
										</div>
									</div>
									<div class="bday_month">
										<div class="select_box">
											<select id="selMonth" name="month">
												<option value="">월</option>
												<option value="01">01</option>
												<option value="02">02</option>
												<option value="03">03</option>
												<option value="04">04</option>
												<option value="05">05</option>
												<option value="06">06</option>
												<option value="07">07</option>
												<option value="08">08</option>
												<option value="09">09</option>
												<option value="10">10</option>
												<option value="11">11</option>
												<option value="12">12</option>
											</select>
										</div>
									</div>
									<div class="bday_day">
										<div class="select_box">
											<select id="selDay" name="day">
												<option value="">일</option>
												<option value="01">01</option>
												<option value="02">02</option>
												<option value="03">03</option>
												<option value="04">04</option>
												<option value="05">05</option>
												<option value="06">06</option>
												<option value="07">07</option>
												<option value="08">08</option>
												<option value="09">09</option>
												<option value="10">10</option>
												<option value="11">11</option>
												<option value="12">12</option>
												<option value="13">13</option>
												<option value="14">14</option>
												<option value="15">15</option>
												<option value="16">16</option>
												<option value="17">17</option>
												<option value="18">18</option>
												<option value="19">19</option>
												<option value="20">20</option>
												<option value="21">21</option>
												<option value="22">22</option>
												<option value="23">23</option>
												<option value="24">24</option>
												<option value="25">25</option>
												<option value="26">26</option>
												<option value="27">27</option>
												<option value="28">28</option>
												<option value="29">29</option>
												<option value="30">30</option>
												<option value="31">31</option>
											</select>
										</div>
									</div>
								</div>
								</div>
								<div class="err_wrap">
									<p class="err_txt" id="bdayMsg">
										<!-- 생년월일을 입력하세요. -->
									</p>
								</div>
								
								<div style="padding-bottom: 0px; height: 20px;">
									<h5 class="w_helper" style="margin-top: 15px;">주소<i class="txt_point">*</i>
									<div class="form-group input_user_address">
										<input type="text" class="user_pw" placeholder="우편번호" name="mzipcode" id="mzipcode" required style="width: 120px; display: inline;">
										<button id="postBtn2" class="btnBasic2" onclick="execPostCode();" style="margin-left: 10px; display:none; ">주소검색</button>
									</div>
									
									<div class="form-group">
										<input class="form-control user_pw" style="top: 5px;" placeholder="도로명 주소" name="maddress1" id="maddress1" type="text"  required />
									</div>
									<div class="form-group">
											<input class="form-control user_pw" placeholder="상세주소" name="maddress2" id="maddress2" type="text" autocomplete='off' required/>
										</div>
								</div>
								
						</div>
						<div>
							<input type="hidden" name="CSRFToken" value="692b5e07-aaa2-41fc-89c0-ecbd6ce20411">
						</div>
					</form>
					<div class="btn_wrap btn_wrap_div2" style="margin-top: 125px;">
						<button class="btnstl3 border_btn_gray btn_cnl" id="cancleBtn" onclick="cancelBtn();">취소</button>
						<button class="btnstl3 solid_btn_blk btn_agree" id="joinBtn" onclick="registerMember(); joinFormCheck();">동의하고 계속</button>
					</div>
				</div>
			</div>
			<script>
			function registerMember() {
				let form = document.getElementById("memberJoinForm");
				form.submit();
			}
			
			function cancelBtn() {
				console.log("취소버튼!!");
				location.href = "/member/CustomLogin";
			}
			</script>
			
			<script>
			var flag = 0;
			// 아이디 중복체크
			$('.id_input').on("propertychange change keydown paste input", function() { //키보드를 누를 때마다 ajax 통신
				/* let csrfHeaderName = "${_csrf.headerName}";
				let csrfTokenValue = "${_csrf.token}"; */
				let mid = $('.id_input').val(); //아이디 입력한 값
				let data = {
					mid : mid
				} 
				console.log("키보드 온!!!!!!!!!!");
			/* 	console.log(csrfHeaderName);
				console.log(csrfTokenValue); */
				
				$.ajax({
					type : "post",
					url : "/member/memberIdChk", //Controller에서 요청 받을 주소
					data : data,
					/* beforeSend : function(xhr) { //csrf 토큰
						if (csrfHeaderName && csrfTokenValue) {
							xhr.setRequestHeader(csrfHeaderName, csrfTokenValue);

						}
					}, */
					success : function(result) {
						console.log("성공 여부" + result);
						
						if (result != 'fail' && mid != '') { //동일한 경우
							$('.id_input_re_1').css("display", "inline-block");
							$('.id_input_re_2').css("display", "none");
							flag = 0;
							console.log(flag);
						} else if (mid == '' && result != 'fail') { //아이디입력이 공백인 경우
							$('.id_input_re_2').css("display", "none");
							$('.id_input_re_1').css("display", "none");
						} else {//아이디가 다른경우
							$('.id_input_re_2').css("display", "inline-block");
							$('.id_input_re_1').css("display", "none");
							flag = 1;
							console.log(flag);
						}
					}// success 종료
				}); // ajax 종료		

			});
			
			//아이디 입력하고 공백으로 변경후 다른 곳으로 focus가 이동했을 때
			$('.id_input').focusout(function() {
				let temp = $('.id_input').val();
				if (temp == '') {

					$(".id_input_re_1").css('display', 'none');
					$(".id_input_re_2").css('display', 'none');
				} else if (flag == 1) {
					
					console.log(temp);
					$('.id_input').val('');
				}
			});
			</script>
			
				<script>
				// 비밀번호 동일 체크
				$("#mpassword , #mpassword2").focusout(function() {
					var pwd1 = $("#mpassword").val();
					var pwd2 = $("#mpassword2").val();

					if (pwd1 != '' && pwd2 == '') {
						null;
					} else if (pwd1 != "" || pwd2 != "") {
						if (pwd1 == pwd2) {
							$(".alert-success").css('display', 'inline-block');
							$(".alert-danger").css('display', 'none');
						} else {
							$(".alert-success").css('display', 'none');
							$(".alert-danger").css('display', 'inline-block');
						}
					}
				});
				
				//비밀번호 입력하고 공백으로 변경후 다른 곳으로 focus가 이동했을 때
				$('.user_pw').focusout(function() {
					var temp = $('#mpassword').val();
					if (temp == '') {

						$("#mpassword").css('display', 'none');
						$("#mpassword2").css('display', 'none');
					} else if (flag == 1) {
						console.log(temp);
						$('#mpassword').val('');

					}
				});
				
				$('#join_button').on("click", function() {
					console.log("회원가입 버튼 클릭!!!!!!!!!");
				})
				
				//아이디, 이름, 이메일, 비밀번호, 핸드폰 번호, 생년월일, 주소 입력 하나라도 안하면 안ㅇ 넘어감
				//아이디 중복이면 안 넘어감
				//비번 두개 같지 않으면 안 넘어감
				
				</script>
				
				<script>
				//카카오 주소 API
				function execPostCode() {
					new daum.Postcode(
							{
								oncomplete : function (data) {
									// 팝업에서 검색결과 항목을 클릭했을때 실행할 코드를 작성하는 부분.

									// 도로명 주소의 노출 규칙에 따라 주소를 조합한다.
									// 내려오는 변수가 값이 없는 경우엔 공백('')값을 가지므로, 이를 참고하여 분기 한다.
									let fullRoadAddr = data.roadAddress; // 도로명 주소 변수
									let extraRoadAddr = ''; // 도로명 조합형 주소 변수

									// 법정동명이 있을 경우 추가한다. (법정리는 제외)
									// 법정동의 경우 마지막 문자가 "동/로/가"로 끝난다.
									if (data.bname !== ''
											&& /[동|로|가]$/g.test(data.bname)) {
										extraRoadAddr += data.bname;
									}
									// 건물명이 있고, 공동주택일 경우 추가한다.
									if (data.buildingName !== ''
											&& data.apartment === 'Y') {
										extraRoadAddr += (extraRoadAddr !== '' ? ', '
												+ data.buildingName
												: data.buildingName);
									}
									// 도로명, 지번 조합형 주소가 있을 경우, 괄호까지 추가한 최종 문자열을 만든다.
									if (extraRoadAddr !== '') {
										extraRoadAddr = ' (' + extraRoadAddr
												+ ')';
									}
									// 도로명, 지번 주소의 유무에 따라 해당 조합형 주소를 추가한다.
									if (fullRoadAddr !== '') {
										fullRoadAddr += extraRoadAddr;
									}

									// 우편번호와 주소 정보를 해당 필드에 넣는다.
									console.log(data.zonecode);
									console.log(fullRoadAddr);

									$("[name=mzipcode]").val(data.zonecode);
									$("[name=maddress1]").val(fullRoadAddr);
								}
							}).open();
				}
			</script>
		</div>
		<div class="hs_pro_view_layer" style="z-index: 1000"></div>

	</div>
	</div>
	<script type="text/javascript"
		src="http://www.thehandsome.com/_ui/handsomemobile/js/clipboard.min.js"></script>
	<div class="layerpop_wrap loading_layer_wrap">
		<!-- layerpop_middle s -->
		<div class="lyrpp_mid">
			<div class="loading_box"></div>
		</div>
	</div>
	<aside th:insert="~{include/aside}"></aside>
</body>
</html>
